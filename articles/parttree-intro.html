<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="parttree">
<title>Introduction to parttree • parttree</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to parttree">
<meta property="og:description" content="parttree">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">parttree</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1.9002</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/parttree-intro.html">Introduction to parttree</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/grantmcdermott/parttree/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction to parttree</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/grantmcdermott/parttree/blob/HEAD/vignettes/parttree-intro.Rmd" class="external-link"><code>vignettes/parttree-intro.Rmd</code></a></small>
      <div class="d-none name"><code>parttree-intro.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="basic-use">Basic use<a class="anchor" aria-label="anchor" href="#basic-use"></a>
</h2>
<p>Let’s start by loading the <strong>parttree</strong> package
alongside <strong>rpart</strong>, which comes bundled with the base R
installation and is what we’ll use for fitting our decision trees (at
least, to start with). For the basic examples that follow, I’ll use the
well-known <a href="https://allisonhorst.github.io/palmerpenguins/" class="external-link">Palmer
Penguins</a> dataset to demonstrate functionality. You can load this
dataset via the parent package (as I have here), or import it directly
as a CSV <a href="https://vincentarelbundock.github.io/Rdatasets/csv/palmerpenguins/penguins.csv" class="external-link">here</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/bethatkinson/rpart" class="external-link">rpart</a></span><span class="op">)</span>     <span class="co"># For fitting decisions trees</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/grantmcdermott/parttree" class="external-link">parttree</a></span><span class="op">)</span>  <span class="co"># This package (will automatically load ggplot2 too)</span></span>
<span><span class="co">#&gt; Loading required package: ggplot2</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html" class="external-link">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_linedraw</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># install.packages("palmerpenguins")</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"penguins"</span>, package <span class="op">=</span> <span class="st">"palmerpenguins"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">penguins</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 8</span></span></span>
<span><span class="co">#&gt;   species island    bill_length_mm bill_depth_mm flipper_l…¹ body_…² sex    year</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Adelie  Torgersen           39.1          18.7         181    <span style="text-decoration: underline;">3</span>750 male   <span style="text-decoration: underline;">2</span>007</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Adelie  Torgersen           39.5          17.4         186    <span style="text-decoration: underline;">3</span>800 fema…  <span style="text-decoration: underline;">2</span>007</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Adelie  Torgersen           40.3          18           195    <span style="text-decoration: underline;">3</span>250 fema…  <span style="text-decoration: underline;">2</span>007</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Adelie  Torgersen           <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span>            <span style="color: #BB0000;">NA</span>      <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>     <span style="text-decoration: underline;">2</span>007</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Adelie  Torgersen           36.7          19.3         193    <span style="text-decoration: underline;">3</span>450 fema…  <span style="text-decoration: underline;">2</span>007</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Adelie  Torgersen           39.3          20.6         190    <span style="text-decoration: underline;">3</span>650 male   <span style="text-decoration: underline;">2</span>007</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with abbreviated variable names ¹​flipper_length_mm, ²​body_mass_g</span></span></span></code></pre></div>
<div class="section level3">
<h3 id="categorical-predictions">Categorical predictions<a class="anchor" aria-label="anchor" href="#categorical-predictions"></a>
</h3>
<p>Say we are interested in predicting the penguins <em>species</em> as
a function of 1) flipper length and 2) bill length. We can visualize
these relationships as a simple scatter plot prior to doing any formal
modeling.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">=</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">penguins</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">flipper_length_mm</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="parttree-intro_files/figure-html/penguin_plot_cat1-1.png" width="700"></p>
<p>Recasting in terms of a decision tree is easily done (e.g., with
<code>rpart</code>). However, visualizing the resulting tree predictions
against the raw data is hard to do out of the box and this where
<strong>parttree</strong> enters the fray. The main function that users
will interact with is <code><a href="../reference/geom_parttree.html">geom_parttree()</a></code>, which provides a new
geom layer for <strong>ggplot2</strong> objects.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Fit a decision tree using the same variables as the above plot</span></span>
<span><span class="va">tree</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart</a></span><span class="op">(</span><span class="va">species</span> <span class="op">~</span> <span class="va">flipper_length_mm</span> <span class="op">+</span> <span class="va">bill_length_mm</span>, data <span class="op">=</span> <span class="va">penguins</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Visualize the tree partitions by adding it to our plot with geom_parttree()</span></span>
<span><span class="va">p</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="../reference/geom_parttree.html">geom_parttree</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tree</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">species</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"Note: Points denote observations. Shaded regions denote model predictions."</span><span class="op">)</span></span></code></pre></div>
<p><img src="parttree-intro_files/figure-html/penguin_plot_cat2-1.png" width="700"></p>
<div class="section level4">
<h4 id="continuous-predictions">Continuous predictions<a class="anchor" aria-label="anchor" href="#continuous-predictions"></a>
</h4>
<p>Trees with continuous independent variables are also supported.
However, I recommend adjusting the plot fill aesthetic since your model
will likely partition the data into intervals that don’t match up
exactly with the raw data. The easiest way to do this is by setting your
colour and fill aesthetic together as part of the same
<code>scale_colour_*</code> call.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree2</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart</a></span><span class="op">(</span><span class="va">body_mass_g</span> <span class="op">~</span> <span class="va">flipper_length_mm</span> <span class="op">+</span> <span class="va">bill_length_mm</span>, data<span class="op">=</span><span class="va">penguins</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">penguins</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">flipper_length_mm</span>, y <span class="op">=</span> <span class="va">bill_length_mm</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_parttree.html">geom_parttree</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tree2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">body_mass_g</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">body_mass_g</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_viridis.html" class="external-link">scale_colour_viridis_c</a></span><span class="op">(</span>aesthetics <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'colour'</span>, <span class="st">'fill'</span><span class="op">)</span><span class="op">)</span> <span class="co"># NB: Set colour + fill together</span></span></code></pre></div>
<p><img src="parttree-intro_files/figure-html/penguin_plot_con-1.png" width="700"></p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="supported-model-classes">Supported model classes<a class="anchor" aria-label="anchor" href="#supported-model-classes"></a>
</h2>
<p>Currently, the package works with decision trees created by the <a href="https://CRAN.R-project.org/web/package=rpart" class="external-link"><strong>rpart</strong></a>
and <a href="https://CRAN.R-project.org/web/package=partykit" class="external-link"><strong>partykit</strong></a>
packages. Moreover, it supports other front-end modes that call
<code><a href="https://rdrr.io/pkg/rpart/man/rpart.html" class="external-link">rpart::rpart()</a></code> as the underlying engine; in particular the
<a href="https://www.tidymodels.org/" class="external-link"><strong>tidymodels</strong></a>
(<a href="https://parsnip.tidymodels.org/" class="external-link">parsnip</a> or <a href="https://workflows.tidymodels.org/" class="external-link">workflows</a>) and <a href="https://mlr3.mlr-org.com/" class="external-link"><strong>mlr3</strong></a> packages.
Here’s a quick example with <strong>parsnip</strong>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span> <span class="co">## For consistent jitter</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/tidymodels/parsnip" class="external-link">parsnip</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paulhendricks/titanic" class="external-link">titanic</a></span><span class="op">)</span> <span class="co">## Just for a different data set</span></span>
<span></span>
<span><span class="va">titanic_train</span><span class="op">$</span><span class="va">Survived</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">titanic_train</span><span class="op">$</span><span class="va">Survived</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Build our tree using parsnip (but with rpart as the model engine)</span></span>
<span><span class="va">ti_tree</span> <span class="op">=</span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/decision_tree.html" class="external-link">decision_tree</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_engine.html" class="external-link">set_engine</a></span><span class="op">(</span><span class="st">"rpart"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://parsnip.tidymodels.org/reference/set_args.html" class="external-link">set_mode</a></span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://generics.r-lib.org/reference/fit.html" class="external-link">fit</a></span><span class="op">(</span><span class="va">Survived</span> <span class="op">~</span> <span class="va">Pclass</span> <span class="op">+</span> <span class="va">Age</span>, data <span class="op">=</span> <span class="va">titanic_train</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Plot the data and model partitions</span></span>
<span><span class="va">titanic_train</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">Pclass</span>, y<span class="op">=</span><span class="va">Age</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_jitter.html" class="external-link">geom_jitter</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col<span class="op">=</span><span class="va">Survived</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_parttree.html">geom_parttree</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">ti_tree</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill<span class="op">=</span><span class="va">Survived</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span></code></pre></div>
<p><img src="parttree-intro_files/figure-html/titanic_plot-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="plot-orientation">Plot orientation<a class="anchor" aria-label="anchor" href="#plot-orientation"></a>
</h2>
<p>Underneath the hood, <code><a href="../reference/geom_parttree.html">geom_parttree()</a></code> is calling the
companion <code><a href="../reference/parttree.html">parttree()</a></code> function, which coerces the
<strong>rpart</strong> tree object into a data frame that is easily
understood by <strong>ggplot2</strong>. For example, consider again our
first “tree” model from earlier. Here’s the print output of the raw
model.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree</span></span>
<span><span class="co">#&gt; n=342 (2 observations deleted due to missingness)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; node), split, n, loss, yval, (yprob)</span></span>
<span><span class="co">#&gt;       * denotes terminal node</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; 1) root 342 191 Adelie (0.441520468 0.198830409 0.359649123)  </span></span>
<span><span class="co">#&gt;   2) flipper_length_mm&lt; 206.5 213  64 Adelie (0.699530516 0.295774648 0.004694836)  </span></span>
<span><span class="co">#&gt;     4) bill_length_mm&lt; 43.35 150   5 Adelie (0.966666667 0.033333333 0.000000000) *</span></span>
<span><span class="co">#&gt;     5) bill_length_mm&gt;=43.35 63   5 Chinstrap (0.063492063 0.920634921 0.015873016) *</span></span>
<span><span class="co">#&gt;   3) flipper_length_mm&gt;=206.5 129   7 Gentoo (0.015503876 0.038759690 0.945736434) *</span></span></code></pre></div>
<p>And here’s what we get after we feed it to
<code><a href="../reference/parttree.html">parttree()</a></code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/parttree.html">parttree</a></span><span class="op">(</span><span class="va">tree</span><span class="op">)</span></span>
<span><span class="co">#&gt;   node   species                                                  path  xmin</span></span>
<span><span class="co">#&gt; 1    3    Gentoo                            flipper_length_mm &gt;= 206.5 206.5</span></span>
<span><span class="co">#&gt; 2    4    Adelie  flipper_length_mm &lt; 206.5 --&gt; bill_length_mm &lt; 43.35  -Inf</span></span>
<span><span class="co">#&gt; 3    5 Chinstrap flipper_length_mm &lt; 206.5 --&gt; bill_length_mm &gt;= 43.35  -Inf</span></span>
<span><span class="co">#&gt;    xmax  ymin  ymax</span></span>
<span><span class="co">#&gt; 1   Inf  -Inf   Inf</span></span>
<span><span class="co">#&gt; 2 206.5  -Inf 43.35</span></span>
<span><span class="co">#&gt; 3 206.5 43.35   Inf</span></span></code></pre></div>
<p>Again, the resulting data frame is designed to be amenable to a
<strong>ggplot2</strong> geom layer, with columns like
<code>xmin</code>, <code>xmax</code>, etc. specifying aesthetics that
<strong>ggplot2</strong> recognises. (Fun fact:
<code><a href="../reference/geom_parttree.html">geom_parttree()</a></code> is really just a thin wrapper around
<code><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_rect()</a></code>.) The goal of the package is to abstract away
these kinds of details from the user, so we can just specify
<code><a href="../reference/geom_parttree.html">geom_parttree()</a></code> — with a valid tree object as the data
input — and be done with it. However, while this generally works well,
it can sometimes lead to unexpected behaviour in terms of plot
orientation. That’s because it’s hard to guess ahead of time what the
user will specify as the x and y variables (i.e. axes) in their other
plot layers. To see what I mean, let’s redo our penguin plot from
earlier, but this time switch the axes in the main <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot()</a></code>
call.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## First, redo our first plot but this time switch the x and y variables</span></span>
<span><span class="va">p3</span> <span class="op">=</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">penguins</span>, </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">bill_length_mm</span>, y <span class="op">=</span> <span class="va">flipper_length_mm</span><span class="op">)</span> <span class="co">## Switched!</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>col <span class="op">=</span> <span class="va">species</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Add on our tree (and some preemptive titling..)</span></span>
<span><span class="va">p3</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_parttree.html">geom_parttree</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tree</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">species</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Oops!"</span>,</span>
<span>    subtitle <span class="op">=</span> <span class="st">"Looks like a mismatch between our x and y axes..."</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p><img src="parttree-intro_files/figure-html/tree_plot_mismatch-1.png" width="700"></p>
<p>As was the case here, this kind of orientation mismatch is normally
(hopefully) pretty easy to recognize. To fix, we can use the
<code>flipaxes = TRUE</code> argument to flip the orientation of the
<code>geom_parttree</code> layer.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p3</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="../reference/geom_parttree.html">geom_parttree</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="va">tree</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">species</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>    flipaxes <span class="op">=</span> <span class="cn">TRUE</span>  <span class="co">## Flip the orientation</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"That's better"</span><span class="op">)</span></span></code></pre></div>
<p><img src="parttree-intro_files/figure-html/tree_plot_flip-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="base-graphics">Base graphics<a class="anchor" aria-label="anchor" href="#base-graphics"></a>
</h2>
<p>While the package has been primarily designed to work with
<strong>ggplot2</strong>, the <code><a href="../reference/parttree.html">parttree()</a></code> infrastructure can
also be used to generate plots with base graphics. Here, the
<code><a href="https://rdrr.io/pkg/partykit/man/ctree.html" class="external-link">ctree()</a></code> function from <strong>partykit</strong> is used for
fitting the tree.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://partykit.r-forge.r-project.org/partykit/" class="external-link">partykit</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: grid</span></span>
<span><span class="co">#&gt; Loading required package: libcoin</span></span>
<span><span class="co">#&gt; Loading required package: mvtnorm</span></span>
<span></span>
<span><span class="co">## CTree and corresponding partition</span></span>
<span><span class="va">ct</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/partykit/man/ctree.html" class="external-link">ctree</a></span><span class="op">(</span><span class="va">species</span> <span class="op">~</span> <span class="va">flipper_length_mm</span> <span class="op">+</span> <span class="va">bill_length_mm</span>, data <span class="op">=</span> <span class="va">penguins</span><span class="op">)</span></span>
<span><span class="va">pt</span> <span class="op">=</span> <span class="fu"><a href="../reference/parttree.html">parttree</a></span><span class="op">(</span><span class="va">ct</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## Color palette</span></span>
<span><span class="va">pal</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palette.html" class="external-link">palette.colors</a></span><span class="op">(</span><span class="fl">4</span>, <span class="st">"R4"</span><span class="op">)</span><span class="op">[</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span></span>
<span></span>
<span><span class="co">## Maximum/minimum for plotting range as rect() does not handle Inf well</span></span>
<span><span class="va">m</span> <span class="op">=</span> <span class="fl">1000</span></span>
<span></span>
<span><span class="co">## scatter plot() with added rect()</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">bill_length_mm</span> <span class="op">~</span> <span class="va">flipper_length_mm</span>, data <span class="op">=</span> <span class="va">penguins</span>, col <span class="op">=</span> <span class="va">pal</span><span class="op">[</span><span class="va">species</span><span class="op">]</span>, pch <span class="op">=</span> <span class="fl">19</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/rect.html" class="external-link">rect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="op">-</span><span class="va">m</span>, <span class="va">pt</span><span class="op">$</span><span class="va">xmin</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmax</a></span><span class="op">(</span><span class="op">-</span><span class="va">m</span>, <span class="va">pt</span><span class="op">$</span><span class="va">ymin</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">pt</span><span class="op">$</span><span class="va">xmax</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">m</span>, <span class="va">pt</span><span class="op">$</span><span class="va">ymax</span><span class="op">)</span>,</span>
<span>  col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/adjustcolor.html" class="external-link">adjustcolor</a></span><span class="op">(</span><span class="va">pal</span>, alpha.f <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">[</span><span class="va">pt</span><span class="op">$</span><span class="va">species</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p><img src="parttree-intro_files/figure-html/ctree_base_graphics-1.png" width="700"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Grant McDermott.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
